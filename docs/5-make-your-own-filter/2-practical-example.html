
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Practical example Â· My Book</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-insert-logo/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="3-going-further.html" />
    
    
    <link rel="prev" href="1-lets-start.html" />
    

    
        <link rel="shortcut icon" href='../images/favicon.png' type="image/x-icon">
    
    
        <link rel="bookmark" href='../images/favicon.png' type="image/x-icon">
    
    
        <link rel="apple-touch-icon" href='../images/favicon.png'>
    
    
        
        <link rel="apple-touch-icon" sizes="120x120" href="../images/favicon.png">
        
        <link rel="apple-touch-icon" sizes="180x180" href="../images/favicon.png">
        
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../1-overview/0-README.html">
            
                <a href="../1-overview/0-README.html">
            
                    
                    Pixpipe Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html">
            
                    
                    Core Description
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html#generic-interfaces">
            
                    
                    Generic Interfaces
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html#pixpipeobject">
            
                    
                    PixpipeObject
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html#pixpipecontainer">
            
                    
                    PixpipeContainer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html#pixpipecontainermultidata">
            
                    
                    PixpipeContainerMultiData
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html#filter">
            
                    
                    Filter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html#imagetoimagefilter">
            
                    
                    ImageToImageFilter
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html#specialized-objects">
            
                    
                    Specialized Objects
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html#image2d">
            
                    
                    Image2D
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html#image3d">
            
                    
                    Image3D
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html#mnivolume">
            
                    
                    MniVolume
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html#image3dalt">
            
                    
                    Image3DAlt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html#signal1d">
            
                    
                    Signal1D
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.6" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html#linestring">
            
                    
                    LineString
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.7" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html#mesh3d">
            
                    
                    Mesh3D
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../2-core-description/0-README.html">
            
                <a href="../2-core-description/0-README.html#decoders">
            
                    
                    Decoders
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../3-build-pixpipe/0-README.html">
            
                <a href="../3-build-pixpipe/0-README.html">
            
                    
                    Building Pixpipe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../4-learning-with-examples/0-README.html">
            
                <a href="../4-learning-with-examples/0-README.html">
            
                    
                    Learning With Examples
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../4-learning-with-examples/1-basics.html">
            
                <a href="../4-learning-with-examples/1-basics.html">
            
                    
                    Basics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../4-learning-with-examples/2-using-signal1d.html">
            
                <a href="../4-learning-with-examples/2-using-signal1d.html">
            
                    
                    Using Signal1D
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../4-learning-with-examples/3-using-image2d.html">
            
                <a href="../4-learning-with-examples/3-using-image2d.html">
            
                    
                    Using Image2D
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../4-learning-with-examples/4-using-image3d.html">
            
                <a href="../4-learning-with-examples/4-using-image3d.html">
            
                    
                    Using Image3D
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../4-learning-with-examples/5-using-mesh3d.html">
            
                <a href="../4-learning-with-examples/5-using-mesh3d.html">
            
                    
                    Using Mesh3D
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../4-learning-with-examples/7-sparse-interpolation-2d.html">
            
                <a href="../4-learning-with-examples/7-sparse-interpolation-2d.html">
            
                    
                    Sparse Interpolation 2D
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../4-learning-with-examples/advanced.html">
            
                <a href="../4-learning-with-examples/advanced.html">
            
                    
                    Advanced
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="0-README.html">
            
                <a href="0-README.html">
            
                    
                    Make your own filter
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="1-lets-start.html">
            
                <a href="1-lets-start.html">
            
                    
                    Let's Start
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.2" data-path="2-practical-example.html">
            
                <a href="2-practical-example.html">
            
                    
                    Practical example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="3-going-further.html">
            
                <a href="3-going-further.html">
            
                    
                    Going Further
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../GLOSSARY.html">
            
                <a href="../GLOSSARY.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <a target="_blank" href="https://github.com/Pixpipe/pixpipejs">
            
                    
                    Pixpipe on GitHub
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Practical example</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="a-practical-example">A Practical example</h1>
<p>In this section, we will go step by step into a simple example: a filter that performs a simple threshold on an image.<br>You can find this filter in the repo at <code>src/filter/SimpleThresholdFilter.js</code> (<a href="https://github.com/Pixpipe/pixpipejs/blob/master/src/filter/SimpleThresholdFilter.js" target="_blank">source</a>).<br>This filter is simple enough to not have a source cluttered with complicated algorithmic details.<br>Along with the filter, an example of its usage will help you to better understand the logic: <code>examples/imageThresholding.html</code> (<a href="https://github.com/Pixpipe/pixpipejs/blob/master/examples/imageThresholding.html" target="_blank">source</a>, you can also <a href="http://www.pixpipe.io/pixpipejs/examples/imageThresholding.html" target="_blank">run this example</a>).</p>
<p>The following is a step-by-step explanation of what happens in this filter.</p>
<h2 id="first-the-structure">First, the structure</h2>
<p>The structure is quite basic and very <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/New_in_JavaScript/ECMAScript_2015_support_in_Mozilla" target="_blank">ES6</a>-style.</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// make Image2D and ImageToImageFilter visible from here because we will use them</span>
<span class="hljs-keyword">import</span> { Image2D } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../core/Image2D.js&apos;</span>;
<span class="hljs-keyword">import</span> { ImageToImageFilter } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../core/ImageToImageFilter.js&apos;</span>;

<span class="hljs-comment">// Our new class SimpleThresholdFilter extends from the interface ImageToImageFilter</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleThresholdFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ImageToImageFilter</span> </span>{
  <span class="hljs-keyword">constructor</span>(){
    <span class="hljs-comment">// ... to be implemented</span>
  }

  _run(){
    <span class="hljs-comment">// ... to be implemented</span>
  }

} <span class="hljs-comment">/* END of class SimpleThresholdFilter */</span>

<span class="hljs-comment">// make SimpleThresholdFilter importable</span>
<span class="hljs-keyword">export</span> { SimpleThresholdFilter }
</code></pre>
<p>Depending on what your own filter will do, you may want to inherit directly from <code>Filter</code> rather than from <code>ImageToImageFilter</code>. It&apos;s up to you and like usually in programming, it&apos;s not like there is a single right answer.</p>
<h2 id="adding-the-constructor">Adding the constructor</h2>
<p>Since we inherit from a class, the first thing to do in the constructor is to call the constructor of the parent class using <code>super()</code>:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// make Image2D and ImageToImageFilter visible from here because we will use them</span>
<span class="hljs-keyword">import</span> { Image2D } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../core/Image2D.js&apos;</span>;
<span class="hljs-keyword">import</span> { ImageToImageFilter } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../core/ImageToImageFilter.js&apos;</span>;

<span class="hljs-comment">// Our new class SimpleThresholdFilter extends from the interface ImageToImageFilter</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleThresholdFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ImageToImageFilter</span> </span>{

  <span class="hljs-keyword">constructor</span>(){
    <span class="hljs-keyword">super</span>();

    <span class="hljs-comment">// default values</span>
    <span class="hljs-keyword">this</span>.setMetadata(<span class="hljs-string">&quot;threshold&quot;</span>, <span class="hljs-number">128</span>);
    <span class="hljs-keyword">this</span>.setMetadata(<span class="hljs-string">&quot;lowValue&quot;</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">this</span>.setMetadata(<span class="hljs-string">&quot;highValue&quot;</span>, <span class="hljs-number">255</span>);
    <span class="hljs-keyword">this</span>.setMetadata(<span class="hljs-string">&quot;preserveAlpha&quot;</span>, <span class="hljs-literal">true</span>);
  }


  _run(){
    <span class="hljs-comment">// ... to be implemented</span>
  }

} <span class="hljs-comment">/* END of class SimpleThresholdFilter */</span>

<span class="hljs-comment">// make SimpleThresholdFilter importable</span>
<span class="hljs-keyword">export</span> { SimpleThresholdFilter }
</code></pre>
<p>You know how a threshold works, right? under a certain value a pixel is set to black and over, it&apos;s set to white. But, we have to take in consideration two more things:</p>
<ol>
<li>Our image may have more than 8bit per pixel (standard [0, 255]) but could be float [0.0, 1.0], 12bit ints [0, 4096], 16bits ints [0, 65535], etc.</li>
<li>Our image may have 1, or 3 or 4 or more channels. For the sake of simplicity, we will make this filter compatible with single band (intensity), 3 bands (RGB) and 4 bands (RGBA) images.</li>
</ol>
<p>Still, we want our filter to have built-in default values for the <code>threshold</code>, the value to give when under(<code>lowValue</code>), the value to give when over (<code>highValue</code>) and also if we should preserve the transparency in the case of RGBA images (<code>preserveAlpha</code>).</p>
<h2 id="the-run-method">The _run() method</h2>
<p>All the following takes place in the scope of the <code>_run()</code> method, like here:</p>
<pre><code class="lang-javascript">...

_run(){
  <span class="hljs-comment">// HERE!</span>
}

...
</code></pre>
<p>Remember <code>_run()</code> is called when you explicitely call <code>update()</code>, and you should not call <code>_run()</code> directly!<br>At this stage, if your filter <em>runs</em>, it means it <strong>should</strong> already have an input. Let&apos;s make sure of it:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// the input checking</span>
<span class="hljs-comment">// the input checking</span>
<span class="hljs-keyword">if</span>( ! <span class="hljs-keyword">this</span>.hasValidInput())
  <span class="hljs-keyword">return</span>;
...
</code></pre>
<p>The method <code>hasValidInput()</code> is a legacy from the class <code>Filter</code>. It checks if a filters input is actually like it should be. Since our filter inherits from <code>ImageToImageFilter</code>, it&apos;s constructor (when calling <code>super()</code>) already register that the filter should expect an input of type <code>Image2D</code> and of <em><a href="../GLOSSARY.html#category" class="glossary-term" title="The category is an identifier internally used by filter. They qualify an instance of a data container (see PixpipeContainer) and help Filters to know what input is what.">category</a></em> &quot;0&quot;.  </p>
<p>To manually add an expected input, just add an entry to the <code>inputValidator</code> by calling the method <code>this.addInputValidator</code> from the constructor (after <code>super()</code>). For example, if our filter was requiring 2 <code>Image2D</code> of <a href="../GLOSSARY.html#category" class="glossary-term" title="The category is an identifier internally used by filter. They qualify an instance of a data container (see PixpipeContainer) and help Filters to know what input is what.">category</a> 0 and 1, then we would add that to the constructor:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">this</span>.addInputValidator(<span class="hljs-number">0</span>, Image2D);
<span class="hljs-keyword">this</span>.addInputValidator(<span class="hljs-number">1</span>, Image2D);
</code></pre>
<p>Then, in <code>_run()</code>, calling <code>hasValidInput()</code> in a <em>if</em> statement would make sure our input are actually two <code>Image2D</code> of the given <a href="../GLOSSARY.html#categories" class="glossary-term" title="The category is an identifier internally used by filter. They qualify an instance of a data container (see PixpipeContainer) and help Filters to know what input is what.">categories</a>.<br>If we have no input, we just quit with a warning message. There is no exception to launch, we just don&apos;t have any input, it&apos;s not a big deal and we may want to add one later.</p>
<p>Next, we build some local variables. In Pixpipe, we will often be fetching very large TypedArrays think of it like that: a 1000px by 1000px png (most likely RGBA) is already an array of size 4 million! And nowadays, 1000px by 1000px is not that much so we always have to think about little optimizations because, on a large scale, they will matter <strong>a lot</strong>.<br>So, why local variables? Simply because in Javascript they are faster to fetch than complex objects. Here is how:</p>
<pre><code class="lang-javascript">...

var inputImg = <span class="hljs-keyword">this</span>._getInput( <span class="hljs-number">0</span> );

<span class="hljs-comment">// Number of bands</span>
<span class="hljs-keyword">var</span> ncpp = inputImg.getComponentsPerPixel();

<span class="hljs-comment">// having a local value is faster than fetching an object</span>
<span class="hljs-keyword">var</span> threshold = <span class="hljs-keyword">this</span>.getMetadata(<span class="hljs-string">&quot;threshold&quot;</span>);
<span class="hljs-keyword">var</span> lowValue = <span class="hljs-keyword">this</span>.getMetadata(<span class="hljs-string">&quot;lowValue&quot;</span>);
<span class="hljs-keyword">var</span> highValue = <span class="hljs-keyword">this</span>.getMetadata(<span class="hljs-string">&quot;highValue&quot;</span>);

...
</code></pre>
<p>Then we will start to create the content of our output image, but not the <code>Image2D</code> object yet. First we <em>copy</em> the data array of the input image - copy in the sense of <strong>duplicate</strong> (and not copy of <em>reference</em>):</p>
<pre><code class="lang-javascript">...

<span class="hljs-comment">// get a copy of the input buffer so that we dont overwrite it!</span>
<span class="hljs-keyword">var</span> outputBuffer = inputImg.getDataCopy();

...
</code></pre>
<p>If we wanted to get a reference to the original data array of the input image, we would have used <code>inputImg.getData()</code> instead of <code>inputImg.getDataCopy()</code>. Then modifying the array would change the content of the input image and we don&apos;t want that.</p>
<p>Now, we are dealing with checking the number of components per pixel, remember, we want this filter to accept only 1, 3 and 4 components images:</p>
<pre><code class="lang-javascript">...

<span class="hljs-comment">// if the input image has:</span>
<span class="hljs-comment">// - a single band, OR</span>
<span class="hljs-comment">// - three bands (assuming RGB), OR</span>
<span class="hljs-comment">// - four bands (assuming RGBA)</span>
<span class="hljs-keyword">if</span>(ncpp == <span class="hljs-number">1</span> || ncpp == <span class="hljs-number">3</span> || ncpp == <span class="hljs-number">4</span>){

  <span class="hljs-comment">// later, a few things will go here</span>

}<span class="hljs-keyword">else</span>{
  outputBuffer = <span class="hljs-literal">null</span>;
  <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">&quot;The input data must have 1, 3 or 4 components per pixel.&quot;</span>);
  <span class="hljs-keyword">return</span>;
}

...
</code></pre>
<p>As you can see, if the number of components per pixel (aka. <code>ncpp</code> or as previously said <em>channels</em>) is not like we want, we just quit the function before having mapped any output. Still, we want to rush the <em>garbage collector</em> and remain with a potentially large array copied in memory, so we call <code>outputBuffer = null;</code>. Though this is not mandatory and the <em>garbage collector</em> will come anyway.</p>
<p>Then, let&apos;s fill this <code>if</code>:</p>
<pre><code class="lang-javascript">...
if(ncpp == <span class="hljs-number">1</span> || ncpp == <span class="hljs-number">3</span> || ncpp == <span class="hljs-number">4</span>){


  <span class="hljs-comment">/**************** PART 1 *********************************************/</span>

  <span class="hljs-comment">// we want to preserve transparency ( = not affected by thresholding)</span>
  <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.getMetadata(<span class="hljs-string">&quot;preserveAlpha&quot;</span>) &amp;&amp; ncpp == <span class="hljs-number">4</span>){

  <span class="hljs-comment">/**************** PART 1.1 *********************************************/</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;outputBuffer.length; i++){
      <span class="hljs-comment">// every four band is an alpha band</span>
      <span class="hljs-keyword">if</span>(i%<span class="hljs-number">4</span> == <span class="hljs-number">3</span>){
        <span class="hljs-keyword">continue</span>;
      }
      outputBuffer[i] = outputBuffer[i] &lt; threshold ? lowValue : highValue;
    }

  <span class="hljs-comment">// transparency is altered by the threshold like any other channel</span>
  }<span class="hljs-keyword">else</span>{
  <span class="hljs-comment">/**************** PART 1.2 *********************************************/</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;outputBuffer.length; i++){
      outputBuffer[i] = outputBuffer[i] &lt; threshold ? lowValue : highValue;
    }
  }

  <span class="hljs-comment">/**************** PART 2 *********************************************/</span>

  <span class="hljs-comment">/**************** PART 2.1 *********************************************/</span>
  <span class="hljs-comment">// creating a blank Image2D output and getting the ref</span>
  <span class="hljs-keyword">var</span> outputImg = <span class="hljs-keyword">this</span>._addOutput( Image2D );

  <span class="hljs-comment">/**************** PART 2.2 *********************************************/</span>
  <span class="hljs-comment">// filling it with actual data</span>
  outputImg.setData(
    outputBuffer,
    inputImg.getWidth(),
    inputImg.getHeight(),
    ncpp
  );



}<span class="hljs-keyword">else</span>{
  outputBuffer = <span class="hljs-literal">null</span>;
  <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">&quot;The input data must have 1, 3 or 4 components per pixel.&quot;</span>);
  <span class="hljs-keyword">return</span>;
}
...
</code></pre>
<p>For the sake of readability, the content was split into different parts.</p>
<p><strong>Part 1</strong> is about filling the output array based on its own content. In <strong>Part 1.1</strong> we do care about the alpha channel when we have 4 components, which consists in <em>skipping</em> every 4 channel. In <strong>Part 1.2</strong>, we don&apos;t care of what channel we are processing, we threshold them all.  </p>
<p><strong>Part 2</strong> is about creating the output <code>Image2D</code>. In <strong>Part 2.1</strong>, we can consider <code>_addOutput</code> as a sort of factory that will create a <em>constructed but blank</em> instance of <code>Image2D</code> and will automatically map it to an output of this filter. We could have given this output a specific <em><a href="../GLOSSARY.html#category" class="glossary-term" title="The category is an identifier internally used by filter. They qualify an instance of a data container (see PixpipeContainer) and help Filters to know what input is what.">category</a></em> by adding another argument: <code>this._addOutput( Image2D, &quot;myOutputCategory&quot; );</code>. Since we call it without any <em><a href="../GLOSSARY.html#category" class="glossary-term" title="The category is an identifier internally used by filter. They qualify an instance of a data container (see PixpipeContainer) and help Filters to know what input is what.">category</a></em> argument, the default will be <em>&quot;0&quot;</em>.<br><em>Part 2.2</em> is about associating the typed array we just modified in the loop to the freshly created output image. For that, we give the array, but also the size and the number of components per pixel.</p>
<p>Then, don&apos;t forget to <a href="1-lets-start.html#register-your-filter">register your filter</a> so that you can actually use it!</p>
<h2 id="could-we-do-it-another-way">Could we do it another way?</h2>
<p>Sure, in many other ways. A simple alternative would have been to:</p>
<p>Make a clone of the input image:</p>
<pre><code class="lang-javascript">...
var inputImg = <span class="hljs-keyword">this</span>._getInput( <span class="hljs-number">0</span> );
<span class="hljs-keyword">var</span> outputImage = inputImg.clone();
<span class="hljs-keyword">var</span> outputBuffer = outputImage.getData();
...
</code></pre>
<p>Process <code>outputBuffer</code> the very same way, and in the end, creating mapping manually <code>outputImage</code> as an output with explicitly giving the <a href="../GLOSSARY.html#category" class="glossary-term" title="The category is an identifier internally used by filter. They qualify an instance of a data container (see PixpipeContainer) and help Filters to know what input is what.">category</a> (<em>&quot;0&quot;</em> in this case):</p>
<pre><code class="lang-javascript">...
this._output[<span class="hljs-number">0</span>] = outputImage;
...
</code></pre>
<p>And that&apos;s all, no need to call <code>this._addOutput</code> or <code>outputImg.setData</code> because since <code>outputImg</code> is a clone, it already carries the information about size and number of components.</p>
<p>This method is actually faster and potentially even easier to understand. The only disadvantage is that it lets the developer dealing with the output <em><a href="../GLOSSARY.html#category" class="glossary-term" title="The category is an identifier internally used by filter. They qualify an instance of a data container (see PixpipeContainer) and help Filters to know what input is what.">category</a></em>, which might be a source of error when running the filter.</p>
<script>
if ('UA-110948661-1') {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-110948661-1', 'auto');
	ga('send', 'pageview');
}

</script>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="1-lets-start.html" class="navigation navigation-prev " aria-label="Previous page: Let's Start">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="3-going-further.html" class="navigation navigation-next " aria-label="Next page: Going Further">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Practical example","level":"1.6.2","depth":2,"next":{"title":"Going Further","level":"1.6.3","depth":2,"path":"5-make-your-own-filter/3-going-further.md","ref":"5-make-your-own-filter/3-going-further.md","articles":[]},"previous":{"title":"Let's Start","level":"1.6.1","depth":2,"path":"5-make-your-own-filter/1-lets-start.md","ref":"5-make-your-own-filter/1-lets-start.md","articles":[]},"dir":"ltr"},"config":{"plugins":["insert-logo","favicon","analytics","expandable-chapters","hide-published-with"],"root":".","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"analytics":{"google":"UA-110948661-1"},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"hide-published-with":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"favicon":{"shortcut":"/images/favicon.png","bookmark":"/images/favicon.png","appleTouch":"/images/favicon.png","appleTouchMore":{"120x120":"/images/favicon.png","180x180":"/images/favicon.png"}},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"insert-logo":{"url":"https://github.com/Pixpipe/cookbook/blob/master/docs/images/logo.png?raw=true"},"expandable-chapters":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"My Book","gitbook":"*"},"file":{"path":"5-make-your-own-filter/2-practical-example.md","mtime":"2017-12-11T22:16:47.910Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-01-10T19:50:03.624Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-insert-logo/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-hide-published-with/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

